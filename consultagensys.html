<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Formulario Banca en Línea</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 400px;
      margin: 20px auto;
      background-color: #f9f9f9;
    }
    .form-group {
      margin-bottom: 15px;
    }
    input, select, textarea {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    button {
      padding: 10px 20px;
      margin-right: 10px;
      background-color: #f4a261;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    button:hover {
      background-color: #e0761c;
    }
    .invalid {
      border-color: red;
    }
    .checkbox-group {
      margin-top: 5px;
      display: flex;
      gap: 15px;
      align-items: center;
    }
    .checkbox-group div {
      display: flex;
      align-items: center;
    }
  </style>
</head>
<body>
  <div class="form-group">
    <label for="rut">Rut:</label>
    <input type="text" id="rut" name="rut" placeholder="Ej: 12345678-9 o 12345678K">
    <div class="checkbox-group">
      <div>
        <input type="checkbox" id="ivr" name="ivr">
        <label for="ivr" style="margin-left: 5px;">IVR</label>
      </div>
      <div>
        <input type="checkbox" id="tombola" name="tombola">
        <label for="tombola" style="margin-left: 5px;">TOMBOLA</label>
      </div>
    </div>
  </div>
  <div class="form-group">
    <label for="producto">Producto:</label>
    <select id="producto" name="producto">
      <option value="" selected></option>
      <option value="banca_en_linea">BANCA EN LINEA</option>
      <option value="app">APP</option>
      <option value="tcr">TCR</option>
      <option value="cct">CCT</option>
      <option value="crut">CRUT</option>
      <option value="cheq_elect">CHEQ ELECT</option>
      <option value="cajero">CAJERO</option>
      <option value="caj_vec">CAJ VEC</option>
      <option value="suc">SUC</option>
      <option value="cred_consumo">CRED CONSUMO</option>
      <option value="cred_hipote">CRED HIPOTE</option>
      <option value="apv">APV</option>
      <option value="ddpp">DDPP</option>
      <option value="dpv">DPV</option>
      <option value="asimpino">ASIMPINO</option>
      <option value="chilex">CHILEX</option>
      <option value="seguros">SEGUROS</option>
    </select>
  </div>
  <div class="form-group">
    <label for="monto">Monto:</label>
    <input type="text" id="monto" name="monto">
  </div>
  <div class="form-group">
    <label for="fecha">Fecha:</label>
    <input type="date" id="fecha" name="fecha" value="2025-08-07">
  </div>
  <div class="form-group">
    <label for="canal">Canal:</label>
    <select id="canal" name="canal">
      <option value="" selected></option>
      <option value="bloqueo_6002007000">Bloqueo_6002007000</option>
      <option value="bloqueos_800802020">Bloqueos_800802020</option>
      <option value="emergencias_800802020">emergencias_800802020</option>
      <option value="orden_no_pago_6002007000">Orden_no_pago_6002007000</option>
      <option value="orden_no_pago_800802020">Orden_no_Pago_800802020</option>
      <option value="postventa_6002007000">PostVenta_6002007000</option>
      <option value="postventa_800802020">PostVenta_800802020</option>
      <option value="requerimientos_atencionproducto">Requerimientos_AtencionProducto</option>
      <option value="requerimientos_atencionproducto_6002007000">Requerimientos_atencionproducto_6002007000</option>
      <option value="requerimientos_leyfraude">Requerimientos_LeyFraude</option>
      <option value="soporteweb_6002007000">SoporteWEB_6002007000</option>
    </select>
  </div>
  <div class="form-group">
    <label for="descripcion">Descripción:</label>
    <textarea id="descripcion" name="descripcion" rows="4">El cliente consulta por, </textarea>
  </div>
  <div>
    <button onclick="copyToClipboard()">COPIAR</button>
    <button onclick="document.getElementById('rut').value = ''; document.getElementById('monto').value = ''; document.getElementById('descripcion').value = 'El cliente consulta por, '; document.getElementById('ivr').checked = false; document.getElementById('tombola').checked = false;">LIMPIAR</button>
    <button onclick="document.body.classList.toggle('dark-mode')">MODO OSCURO</button>
  </div>
  <style>
    .dark-mode {
      background-color: #333;
      color: #fff;
    }
    .dark-mode input, .dark-mode select, .dark-mode textarea {
      background-color: #555;
      color: #fff;
      border-color: #777;
    }
  </style>
  <script>
    // Validación de RUT chileno
    function validateRut(rut) {
      rut = rut.replace(/[^0-9kK-]/g, '').toUpperCase();
      if (!rut || rut.length < 3) return false;

      // Formato: 12345678-9 o 12345678K
      let cuerpo, dv;
      if (rut.includes('-')) {
        let parts = rut.split('-');
        if (parts.length !== 2 || parts[1].length !== 1) return false;
        cuerpo = parts[0];
        dv = parts[1];
      } else {
        if (rut.length < 2) return false;
        cuerpo = rut.slice(0, -1);
        dv = rut.slice(-1);
      }

      if (!/^\d+$/.test(cuerpo) || cuerpo.length < 6 || cuerpo.length > 8) return false;
      if (!/^[0-9K]$/.test(dv)) return false;

      let suma = 0;
      let multiplo = 2;
      for (let i = cuerpo.length - 1; i >= 0; i--) {
        suma += parseInt(cuerpo[i]) * multiplo;
        multiplo = multiplo === 7 ? 2 : multiplo + 1;
      }
      let dvEsperado = 11 - (suma % 11);
      dvEsperado = dvEsperado === 11 ? '0' : dvEsperado === 10 ? 'K' : dvEsperado.toString();
      return dvEsperado === dv;
    }

    document.getElementById('rut').addEventListener('input', function(e) {
      let value = e.target.value.replace(/[^0-9kK-]/g, '').toUpperCase();
      
      // Limitar a 8 dígitos antes del guión y 1 después
      if (value.includes('-')) {
        let parts = value.split('-');
        if (parts[0].length > 8) parts[0] = parts[0].slice(0, 8);
        if (parts[1].length > 1) parts[1] = parts[1].slice(0, 1);
        value = parts[0] + '-' + parts[1];
      } else if (value.length > 9) {
        value = value.slice(0, 8) + value.slice(-1);
      }

      e.target.value = value;

      if (!validateRut(value)) {
        e.target.classList.add('invalid');
      } else {
        e.target.classList.remove('invalid');
      }
    });

    // Formato de Monto como moneda (ej. $ 11.359.018)
    document.getElementById('monto').addEventListener('input', function(e) {
      let value = e.target.value.replace(/[^0-9]/g, '');
      if (value.length > 12) value = value.slice(0, 12); // Límite razonable para monto
      let formattedValue = value.replace(/\B(?=(\d{3})+(?!\d))/g, '.');
      if (formattedValue) {
        e.target.value = '$ ' + formattedValue;
      } else {
        e.target.value = '';
      }
    });

    // Copiar todos los campos al portapapeles
    function copyToClipboard() {
      let rut = document.getElementById('rut').value;
      let producto = document.getElementById('producto').value;
      let monto = document.getElementById('monto').value;
      let fecha = document.getElementById('fecha').value;
      let canal = document.getElementById('canal').value;
      let descripcion = document.getElementById('descripcion').value;
      let ivr = document.getElementById('ivr').checked ? 'SI' : 'NO';
      let tombola = document.getElementById('tombola').checked ? 'SI' : 'NO';
      let text = `Rut: ${rut}\nProducto: ${producto}\nMonto: ${monto}\nFecha: ${fecha}\nCanal: ${canal}\nDescripción: ${descripcion}\nIVR: ${ivr}\nTOMBOLA: ${tombola}`;
      navigator.clipboard.writeText(text).then(() => alert('Copiado al portapapeles!'));
    }
  </script>
</body>
</html>